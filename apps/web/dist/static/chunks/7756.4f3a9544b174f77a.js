"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7756],{17756:(e,s,a)=>{a.r(s),a.d(s,{UserNFTs:()=>w});var t=a(95688),r=a(27100),n=a(82638),l=a(23688),i=a(65561),c=a(35083),d=a(20347),o=a(61743),m=a(57824),x=a(67396),h=a(55340),u=a(19073),j=a(76472),p=a(55392),g=a(54980),N=a(16350),f=a(63186);function v(e){var s,a,h,p;let{position:v,onClaim:w}=e,y=(0,j.a)(),[b,T]=(0,x.useState)(!1),F=(0,g.G)(),k=(null==(s=v.product)?void 0:s.type)||v.productType,A=u.Tg[k]||{name:(null==(a=v.product)?void 0:a.name)||"未知产品",icon:"\uD83D\uDCCA",color:"from-gray-400 to-gray-600",apr:(null==(h=v.product)?void 0:h.apr)||0,duration:(null==(p=v.product)?void 0:p.duration)||0},S=Number.parseFloat(v.principal||"0"),C=Number.parseFloat(v.currentValue||v.principal||"0"),D=Number.parseFloat(v.pendingReward||"0"),I=new Date(v.startDate||v.createdAt).getTime(),U=new Date(v.endDate).getTime(),Z=Date.now(),E=Math.min((Z-I)/(U-I)*100,100),B=Math.max(Math.ceil((U-Z)/864e5),0),R=async()=>{if(v.tokenId&&!(D<=0)){T(!0);try{F.loading("请在钱包中确认领取交易..."),await y.claimReward(BigInt(v.tokenId)),y.isConfirming&&F.loading("等待交易确认..."),y.isSuccess&&(F.success("收益领取成功！"),null==w||w(),window.location.reload())}catch(s){var e;N.vF.error("UserNFTs","Claim failed",s),F.error((null==s||null==(e=s.message)?void 0:e.includes("User rejected"))?"交易已被用户取消":"领取失败，请重试")}finally{T(!1)}}},W="ACTIVE"===v.status,_=E>=100;return(0,t.jsx)(r.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"group",children:(0,t.jsxs)(f.Zp,{className:"relative overflow-hidden hover:shadow-lg transition-shadow duration-300",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br ".concat(A.color," opacity-5")}),(0,t.jsx)(f.aR,{className:"relative",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-2xl",children:A.icon}),(0,t.jsxs)("div",{children:[(0,t.jsx)(f.ZB,{className:"text-lg",children:A.name}),(0,t.jsx)(f.Ex,{variant:W?"default":"secondary",children:W?_?"已到期":"活跃":"已结束"})]})]}),(0,t.jsxs)("div",{className:"text-right",children:[v.tokenId&&(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:["NFT #",v.tokenId]}),(0,t.jsxs)("p",{className:"font-semibold text-green-600",children:[A.apr,"% APR"]})]})]})}),(0,t.jsxs)(f.Wu,{className:"relative space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[(0,t.jsx)(n.A,{className:"w-3 h-3"}),"投资本金"]}),(0,t.jsxs)("p",{className:"font-semibold",children:[S.toLocaleString()," USDT"]})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[(0,t.jsx)(l.A,{className:"w-3 h-3"}),"当前价值"]}),(0,t.jsxs)("p",{className:"font-semibold text-green-600",children:[C.toLocaleString()," USDT"]})]})]}),(0,t.jsx)("div",{className:"p-3 bg-green-50 rounded-lg",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("span",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[(0,t.jsx)(i.A,{className:"w-3 h-3"}),"待领收益"]}),(0,t.jsx)("span",{className:"font-semibold text-green-600",children:D>0?"+".concat(D.toFixed(4)," USDT"):"0 USDT"})]})}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,t.jsxs)("span",{className:"text-muted-foreground flex items-center gap-1",children:[(0,t.jsx)(c.A,{className:"w-3 h-3"}),"投资进度"]}),(0,t.jsx)("span",{className:"font-medium",children:W?B>0?"".concat(B,"天后到期"):"已到期":"已完成"})]}),(0,t.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,t.jsx)("div",{className:"h-2 rounded-full bg-gradient-to-r ".concat(A.color," transition-all duration-300"),style:{width:"".concat(Math.min(E,100),"%")}})}),(0,t.jsxs)("div",{className:"flex justify-between text-xs text-muted-foreground",children:[(0,t.jsx)("span",{children:new Date(I).toLocaleDateString()}),(0,t.jsx)("span",{children:new Date(U).toLocaleDateString()})]})]}),(0,t.jsxs)("div",{className:"flex gap-2 pt-2",children:[(0,t.jsxs)(f.$n,{onClick:R,disabled:D<=0||!W||b,className:"flex-1",size:"sm",children:[b?(0,t.jsx)(d.A,{className:"w-3 h-3 mr-1 animate-spin"}):(0,t.jsx)(i.A,{className:"w-3 h-3 mr-1"}),"领取收益"]}),v.tokenId&&(0,t.jsx)(f.$n,{variant:"outline",size:"sm",onClick:()=>window.open("https://opensea.io/assets/ethereum/".concat(v.tokenId),"_blank"),children:(0,t.jsx)(o.A,{className:"w-3 h-3"})})]}),_&&W&&(0,t.jsxs)(f.Fc,{children:[(0,t.jsx)(m.A,{className:"h-3 w-3"}),(0,t.jsx)(f.TN,{className:"text-xs",children:"投资已到期，请及时领取收益"})]})]})]})})}function w(){let{address:e,isConnected:s}=function(){let[e]=(0,p.Xr)();return{isConnected:e.isConnected,isConnecting:e.isConnecting,address:e.address,chainId:e.chainId,isNetworkSupported:e.isNetworkSupported,ethBalance:e.ethBalance}}(),a=(0,j.a)(),[r,i]=(0,x.useState)([]),[c,d]=(0,x.useState)(!0),o=(0,g.G)();(0,x.useEffect)(()=>{(async()=>{if(e&&s){d(!0);try{let e=(await h.uE.get("/positions/my-positions")).data||[];i(e)}catch(e){N.vF.error("UserNFTs","Failed to fetch user positions",e);try{Number(a.balance||0)>0&&o.error("暂时无法获取NFT数据，请联系技术支持")}catch(e){N.vF.error("UserNFTs","Contract query failed",e)}}finally{d(!1)}}})()},[e,s,a.balance,o]);let m=()=>{o.success("收益领取成功！")};return s?c?(0,t.jsxs)(f.Zp,{children:[(0,t.jsx)(f.aR,{children:(0,t.jsx)(f.ZB,{children:"我的投资凭证"})}),(0,t.jsx)(f.Wu,{children:(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Array.from({length:3},(e,s)=>"s".concat(s)).map(e=>(0,t.jsx)("div",{className:"h-64 bg-gray-200 rounded-lg animate-pulse"},e))})})]}):0===r.length?(0,t.jsxs)(f.Zp,{children:[(0,t.jsx)(f.aR,{children:(0,t.jsx)(f.ZB,{children:"我的投资凭证"})}),(0,t.jsxs)(f.Wu,{className:"text-center py-12",children:[(0,t.jsx)(l.A,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),(0,t.jsx)("p",{className:"text-muted-foreground mb-2",children:"您还没有任何投资持仓"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"购买投资产品后，您将获得相应的NFT作为投资凭证"})]})]}):(0,t.jsxs)(f.Zp,{children:[(0,t.jsx)(f.aR,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(f.ZB,{children:"我的投资凭证"}),(0,t.jsxs)(f.Ex,{variant:"outline",children:[r.length," 个持仓"]})]})}),(0,t.jsx)(f.Wu,{children:(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:r.map(e=>(0,t.jsx)(v,{position:e,onClaim:m},e.id))})})]}):(0,t.jsx)(f.Zp,{children:(0,t.jsxs)(f.Wu,{className:"text-center py-12",children:[(0,t.jsx)(n.A,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"请先连接钱包查看您的投资凭证"})]})})}}}]);