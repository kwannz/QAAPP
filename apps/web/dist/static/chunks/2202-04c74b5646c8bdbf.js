"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2202,8574],{32887:(e,t,r)=>{r.d(t,{OJ:()=>i,nc:()=>u});var a=r(95688),s=r(67396),l=r(88574),n=r(16350);let o=(0,s.createContext)(void 0);function i(e){let{children:t}=e,[i,u]=(0,s.useState)(null),[d,c]=(0,s.useState)(null),[h,f]=(0,s.useState)(null),[k,w]=(0,s.useState)(!1),[T,S]=(0,s.useState)(!1);(0,s.useEffect)(()=>{try{let e=localStorage.getItem("qa-auth-storage");if(e){let t=JSON.parse(e);t.user&&(u(t.user),c(t.accessToken),f(t.refreshToken),w(t.isAuthenticated||!1),l.b.setTokens(t.accessToken,t.refreshToken))}}catch(e){n.vF.warn("AuthContext","Failed to restore auth state",{error:e})}},[]);let g=e=>{try{localStorage.setItem("qa-auth-storage",JSON.stringify(e))}catch(e){n.vF.warn("AuthContext","Failed to save auth state",{error:e})}},v=()=>{u(null),c(null),f(null),w(!1),S(!1),l.b.clearTokens(),g({user:null,accessToken:null,refreshToken:null,isAuthenticated:!1})},A=e=>{S(e)},m=async e=>{A(!0);try{var t,a;let{authApi:s}=await Promise.all([r.e(8735),r.e(7701),r.e(5340)]).then(r.bind(r,55340)),n=await s.login(e);if((null==(t=n.data)?void 0:t.success)&&(null==(a=n.data)?void 0:a.data)){let{accessToken:e,refreshToken:t,user:r}=n.data.data,a={id:r.id,email:r.email,role:r.role,kycStatus:r.kycStatus,referralCode:r.referralCode||"",isActive:!0,wallets:r.walletAddress?[{id:"wallet-001",address:r.walletAddress,chainId:1,isPrimary:!0,label:"Primary Wallet"}]:[],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return u(a),c(e),f(t),w(!0),l.b.setTokens(e,t),g({user:a,accessToken:e,refreshToken:t,isAuthenticated:!0}),{success:!0}}throw Error("Login failed: Invalid response")}catch(e){throw n.vF.error("AuthContext","Login failed",{error:e}),e}finally{A(!1)}},y=async e=>{A(!0);try{var t,a;let{authApi:s}=await Promise.all([r.e(8735),r.e(7701),r.e(5340)]).then(r.bind(r,55340)),n=await s.register({email:e.email,password:e.password,referralCode:e.referralCode});if((null==(t=n.data)?void 0:t.success)&&(null==(a=n.data)?void 0:a.data)){let{accessToken:e,refreshToken:t,user:r}=n.data.data,a={id:r.id,email:r.email,role:r.role,kycStatus:r.kycStatus,referralCode:r.referralCode||"",isActive:!0,wallets:r.walletAddress?[{id:"wallet-001",address:r.walletAddress,chainId:1,isPrimary:!0,label:"Primary Wallet"}]:[],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return u(a),c(e),f(t),w(!0),l.b.setTokens(e,t),g({user:a,accessToken:e,refreshToken:t,isAuthenticated:!0}),{success:!0}}throw Error("Registration failed: Invalid response")}catch(e){throw n.vF.error("AuthContext","Registration failed",{error:e}),e}finally{A(!1)}};return(0,a.jsx)(o.Provider,{value:{user:i,accessToken:d,refreshToken:h,isAuthenticated:k,isLoading:T,setUser:e=>{u(e),w(!0),g({user:e,accessToken:d,refreshToken:h,isAuthenticated:!0})},setTokens:(e,t)=>{c(e),f(t),w(!0),l.b.setTokens(e,t),g({user:i,accessToken:e,refreshToken:t,isAuthenticated:!0})},clearAuth:v,setLoading:A,login:m,logout:()=>{v()},register:y,updateWallets:e=>{if(i){let t={...i,wallets:e};u(t),g({user:t,accessToken:d,refreshToken:h,isAuthenticated:k})}},setPrimaryWallet:e=>{if(null==i?void 0:i.wallets){let t=i.wallets.map(t=>({...t,isPrimary:t.id===e})),r={...i,wallets:t};u(r),g({user:r,accessToken:d,refreshToken:h,isAuthenticated:k})}}},children:t})}function u(){let e=(0,s.useContext)(o);if(void 0===e)throw Error("useAuthStore must be used within an AuthProvider");return e}new Date().toISOString(),new Date().toISOString()},38276:(e,t,r)=>{function a(){}function s(){return void 0!==window.indexedDB}r.d(t,{Iz:()=>s,wZ:()=>a})},88574:(e,t,r)=>{r.d(t,{b:()=>l});var a=r(16350);class s{setTokens(e,t){this.accessToken=e,this.refreshToken=t}getAccessToken(){return this.accessToken}getRefreshToken(){return this.refreshToken}clearTokens(){this.accessToken=null,this.refreshToken=null}restoreFromStorage(){try{let e=localStorage.getItem("qa-auth-storage");if(e){let t=JSON.parse(e);this.accessToken=t.accessToken||null,this.refreshToken=t.refreshToken||null}}catch(e){a.vF.warn("TokenManager","Failed to restore tokens from storage",{error:e})}}constructor(){this.accessToken=null,this.refreshToken=null}}let l=new s;l.restoreFromStorage()}}]);