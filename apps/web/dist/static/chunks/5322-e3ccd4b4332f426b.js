"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5322,8574],{15938:(e,s,t)=>{t.d(s,{f:()=>h});var a=t(95688),r=t(6218),l=t(73693),i=t(87983),n=t(67396),c=t(32887),d=t(63186),o=t(16350),x=t(37811);function h(e){let{children:s,allowedRoles:t=["ADMIN"]}=e,{user:h,isAuthenticated:m,isLoading:u}=(0,c.nc)(),[f,g]=(0,n.useState)(!0),j=(0,i.useRouter)();return((0,n.useEffect)(()=>{let e=setTimeout(()=>{f&&("true"===x.env.NEXT_PUBLIC_ENABLE_DEBUG&&o.vF.warn("AdminGuard","Auth check timeout, assuming not authenticated"),g(!1))},5e3);return(async()=>{if(!u){if(clearTimeout(e),!m||!h)return j.replace("/auth/login?redirect=/admin");if(!t.includes(h.role||""))return j.replace("/dashboard");g(!1)}})(),()=>{clearTimeout(e)}},[m,h,u,j,t,f]),u||f)?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsx)(d.Zp,{className:"w-96",children:(0,a.jsxs)(d.Wu,{className:"p-8 text-center",children:[(0,a.jsx)("div",{className:"flex justify-center mb-4",children:(0,a.jsx)(r.A,{className:"w-12 h-12 text-blue-600 animate-pulse"})}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"验证管理员权限"}),(0,a.jsx)("p",{className:"text-gray-600",children:"正在验证您的访问权限，请稍候..."}),(0,a.jsx)("div",{className:"mt-4 flex justify-center",children:(0,a.jsx)("div",{className:"w-8 h-8 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"})})]})})}):m&&h&&t.includes(h.role||"")?(0,a.jsx)(a.Fragment,{children:s}):(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsx)(d.Zp,{className:"w-96",children:(0,a.jsxs)(d.Wu,{className:"p-8 text-center",children:[(0,a.jsx)("div",{className:"flex justify-center mb-4",children:(0,a.jsx)(l.A,{className:"w-12 h-12 text-red-600"})}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"访问被拒绝"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:"您没有访问管理后台的权限。只有管理员才能访问此区域。"}),(0,a.jsxs)("div",{className:"space-y-2 text-sm text-gray-500",children:[(0,a.jsxs)("p",{children:["当前用户角色: ",(null==h?void 0:h.role)||"未知"]}),(0,a.jsxs)("p",{children:["需要角色: ",t.join(", ")]})]}),(0,a.jsx)("button",{onClick:()=>j.push("/dashboard"),className:"mt-6 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"返回用户中心"})]})})})}},32887:(e,s,t)=>{t.d(s,{OJ:()=>c,nc:()=>d});var a=t(95688),r=t(67396),l=t(88574),i=t(16350);let n=(0,r.createContext)(void 0);function c(e){let{children:s}=e,[c,d]=(0,r.useState)(null),[o,x]=(0,r.useState)(null),[h,m]=(0,r.useState)(null),[u,f]=(0,r.useState)(!1),[g,j]=(0,r.useState)(!1);(0,r.useEffect)(()=>{try{let e=localStorage.getItem("qa-auth-storage");if(e){let s=JSON.parse(e);s.user&&(d(s.user),x(s.accessToken),m(s.refreshToken),f(s.isAuthenticated||!1),l.b.setTokens(s.accessToken,s.refreshToken))}}catch(e){i.vF.warn("AuthContext","Failed to restore auth state",{error:e})}},[]);let p=e=>{try{localStorage.setItem("qa-auth-storage",JSON.stringify(e))}catch(e){i.vF.warn("AuthContext","Failed to save auth state",{error:e})}},v=()=>{d(null),x(null),m(null),f(!1),j(!1),l.b.clearTokens(),p({user:null,accessToken:null,refreshToken:null,isAuthenticated:!1})},y=e=>{j(e)},N=async e=>{y(!0);try{var s,a;let{authApi:r}=await Promise.all([t.e(8735),t.e(7701),t.e(5340)]).then(t.bind(t,55340)),i=await r.login(e);if((null==(s=i.data)?void 0:s.success)&&(null==(a=i.data)?void 0:a.data)){let{accessToken:e,refreshToken:s,user:t}=i.data.data,a={id:t.id,email:t.email,role:t.role,kycStatus:t.kycStatus,referralCode:t.referralCode||"",isActive:!0,wallets:t.walletAddress?[{id:"wallet-001",address:t.walletAddress,chainId:1,isPrimary:!0,label:"Primary Wallet"}]:[],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return d(a),x(e),m(s),f(!0),l.b.setTokens(e,s),p({user:a,accessToken:e,refreshToken:s,isAuthenticated:!0}),{success:!0}}throw Error("Login failed: Invalid response")}catch(e){throw i.vF.error("AuthContext","Login failed",{error:e}),e}finally{y(!1)}},b=async e=>{y(!0);try{var s,a;let{authApi:r}=await Promise.all([t.e(8735),t.e(7701),t.e(5340)]).then(t.bind(t,55340)),i=await r.register({email:e.email,password:e.password,referralCode:e.referralCode});if((null==(s=i.data)?void 0:s.success)&&(null==(a=i.data)?void 0:a.data)){let{accessToken:e,refreshToken:s,user:t}=i.data.data,a={id:t.id,email:t.email,role:t.role,kycStatus:t.kycStatus,referralCode:t.referralCode||"",isActive:!0,wallets:t.walletAddress?[{id:"wallet-001",address:t.walletAddress,chainId:1,isPrimary:!0,label:"Primary Wallet"}]:[],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return d(a),x(e),m(s),f(!0),l.b.setTokens(e,s),p({user:a,accessToken:e,refreshToken:s,isAuthenticated:!0}),{success:!0}}throw Error("Registration failed: Invalid response")}catch(e){throw i.vF.error("AuthContext","Registration failed",{error:e}),e}finally{y(!1)}};return(0,a.jsx)(n.Provider,{value:{user:c,accessToken:o,refreshToken:h,isAuthenticated:u,isLoading:g,setUser:e=>{d(e),f(!0),p({user:e,accessToken:o,refreshToken:h,isAuthenticated:!0})},setTokens:(e,s)=>{x(e),m(s),f(!0),l.b.setTokens(e,s),p({user:c,accessToken:e,refreshToken:s,isAuthenticated:!0})},clearAuth:v,setLoading:y,login:N,logout:()=>{v()},register:b,updateWallets:e=>{if(c){let s={...c,wallets:e};d(s),p({user:s,accessToken:o,refreshToken:h,isAuthenticated:u})}},setPrimaryWallet:e=>{if(null==c?void 0:c.wallets){let s=c.wallets.map(s=>({...s,isPrimary:s.id===e})),t={...c,wallets:s};d(t),p({user:t,accessToken:o,refreshToken:h,isAuthenticated:u})}}},children:s})}function d(){let e=(0,r.useContext)(n);if(void 0===e)throw Error("useAuthStore must be used within an AuthProvider");return e}new Date().toISOString(),new Date().toISOString()},88574:(e,s,t)=>{t.d(s,{b:()=>l});var a=t(16350);class r{setTokens(e,s){this.accessToken=e,this.refreshToken=s}getAccessToken(){return this.accessToken}getRefreshToken(){return this.refreshToken}clearTokens(){this.accessToken=null,this.refreshToken=null}restoreFromStorage(){try{let e=localStorage.getItem("qa-auth-storage");if(e){let s=JSON.parse(e);this.accessToken=s.accessToken||null,this.refreshToken=s.refreshToken||null}}catch(e){a.vF.warn("TokenManager","Failed to restore tokens from storage",{error:e})}}constructor(){this.accessToken=null,this.refreshToken=null}}let l=new r;l.restoreFromStorage()},96753:(e,s,t)=>{t.d(s,{U:()=>k});var a=t(95688),r=t(67380),l=t(96929),i=t(90789),n=t(61724),c=t(79155),d=t(82638),o=t(3519),x=t(83154),h=t(57297),m=t(82570),u=t(4672),f=t(40959),g=t(59202),j=t(85210),p=t.n(j),v=t(87983),y=t(67396),N=t(32887),b=t(63186);let w=[{name:"总览",href:"/admin",icon:r.A,description:"系统概览和统计"},{name:"KYC审核",href:"/admin/kycreview",icon:l.A,description:"用户身份验证审核"},{name:"用户管理",href:"/admin/users",icon:i.A,description:"用户账户管理"},{name:"产品审核",href:"/admin/products",icon:n.A,description:"投资产品管理"},{name:"订单审核",href:"/admin/orders",icon:c.A,description:"交易订单审核"},{name:"提现审核",href:"/admin/withdrawals",icon:d.A,description:"资金提现审核"},{name:"审计日志",href:"/admin/audit-logs",icon:o.A,description:"系统操作记录"},{name:"代理管理",href:"/admin/agents",icon:x.A,description:"代理商管理"}];function k(e){var s,t,r,l,i,n;let{children:c}=e,[d,o]=(0,y.useState)(!1),{user:x,logout:j}=(0,N.nc)(),k=(0,v.usePathname)(),A=(0,v.useRouter)();return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsxs)("div",{className:"fixed inset-0 z-50 lg:hidden ".concat(d?"block":"hidden"),children:[(0,a.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-75",onClick:()=>o(!1)}),(0,a.jsxs)("div",{className:"fixed inset-y-0 left-0 flex w-64 flex-col bg-white shadow-xl",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between px-4 py-6 border-b",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"管理后台"}),(0,a.jsx)(b.$n,{variant:"ghost",size:"sm",onClick:()=>o(!1),children:(0,a.jsx)(h.A,{className:"w-5 h-5"})})]}),(0,a.jsx)("nav",{className:"flex-1 px-4 py-6 space-y-2",children:w.map(e=>{let s=e.icon,t=k===e.href;return(0,a.jsxs)(p(),{href:e.href,className:"flex items-center px-3 py-2 text-sm font-medium rounded-lg transition-colors ".concat(t?"bg-blue-100 text-blue-700 border-r-2 border-blue-700":"text-gray-700 hover:bg-gray-100"),onClick:()=>o(!1),children:[(0,a.jsx)(s,{className:"w-5 h-5 mr-3"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{children:e.name}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:e.description})]})]},e.name)})})]})]}),(0,a.jsx)("div",{className:"hidden lg:fixed lg:inset-y-0 lg:flex lg:w-80 lg:flex-col",children:(0,a.jsxs)("div",{className:"flex flex-1 flex-col bg-white border-r border-gray-200",children:[(0,a.jsx)("div",{className:"flex items-center px-6 py-6 border-b",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-white font-bold",children:"QA"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"管理后台"}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"系统管理控制台"})]})]})}),(0,a.jsx)("nav",{className:"flex-1 px-6 py-6 space-y-2 overflow-y-auto",children:w.map(e=>{let s=e.icon,t=k===e.href;return(0,a.jsxs)(p(),{href:e.href,className:"flex items-center px-4 py-3 text-sm font-medium rounded-lg transition-all duration-200 ".concat(t?"bg-blue-50 text-blue-700 border border-blue-200":"text-gray-700 hover:bg-gray-50 hover:text-gray-900"),children:[(0,a.jsx)(s,{className:"w-5 h-5 mr-3 flex-shrink-0"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"font-medium",children:e.name}),(0,a.jsx)("div",{className:"text-xs text-gray-500 mt-0.5",children:e.description})]})]},e.name)})}),(0,a.jsx)("div",{className:"px-6 py-4 border-t",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-xs font-medium text-gray-600",children:(null==x||null==(t=x.email)||null==(s=t[0])?void 0:s.toUpperCase())||"A"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900",children:(null==x||null==(r=x.email)?void 0:r.split("@")[0])||"管理员"}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:(null==x?void 0:x.role)||"ADMIN"})]})]}),(0,a.jsx)(b.$n,{variant:"ghost",size:"sm",onClick:()=>{j(),A.push("/auth/login")},className:"text-gray-500 hover:text-gray-700",children:(0,a.jsx)(m.A,{className:"w-4 h-4"})})]})})]})}),(0,a.jsxs)("div",{className:"lg:pl-80",children:[(0,a.jsx)("div",{className:"sticky top-0 z-40 bg-white border-b border-gray-200 px-4 py-4 lg:px-8",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)(b.$n,{variant:"ghost",size:"sm",onClick:()=>o(!0),className:"lg:hidden",children:(0,a.jsx)(u.A,{className:"w-5 h-5"})}),(0,a.jsxs)("div",{className:"hidden md:flex items-center space-x-2",children:[(0,a.jsx)(f.A,{className:"w-4 h-4 text-gray-400"}),(0,a.jsx)(b.pd,{placeholder:"搜索用户、订单、日志...",className:"w-80"})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)(b.$n,{variant:"ghost",size:"sm",className:"relative",children:[(0,a.jsx)(g.A,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"absolute -top-1 -right-1 w-2 h-2 bg-red-500 rounded-full"})]}),(0,a.jsxs)("div",{className:"hidden lg:flex items-center space-x-3",children:[(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900",children:(null==x||null==(l=x.email)?void 0:l.split("@")[0])||"管理员"}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:(null==x?void 0:x.role)||"ADMIN"})]}),(0,a.jsx)("div",{className:"w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-xs font-medium text-gray-600",children:(null==x||null==(n=x.email)||null==(i=n[0])?void 0:i.toUpperCase())||"A"})})]})]})]})}),(0,a.jsx)("main",{className:"flex-1 px-4 py-8 lg:px-8",children:c})]})]})}}}]);