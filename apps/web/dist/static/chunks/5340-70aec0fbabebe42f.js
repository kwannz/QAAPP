"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5340],{55340:(e,o,t)=>{t.d(o,{uE:()=>d,authApi:()=>h,Ay:()=>f,monitoringApi:()=>u});var r=t(47701),n=function(e){return e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.WARN=2]="WARN",e[e.ERROR=3]="ERROR",e[e.FATAL=4]="FATAL",e}({});class s{static getEnvironmentLogLevel(){return 3}loadConfig(){let e=localStorage.getItem("logger_config");if(e)try{this.config={...this.config,...JSON.parse(e)}}catch(e){console.error("Failed to load logger config:",e)}}setConfig(e){this.config={...this.config,...e},localStorage.setItem("logger_config",JSON.stringify(this.config)),this.log(1,"Logger","Config updated",{config:this.config})}setUserId(e){this.userId=e,this.log(1,"Logger","User ID set",{userId:e})}generateSessionId(){return"session_".concat(Date.now(),"_").concat(Math.random().toString(36).slice(2,11))}generateRequestId(){return"req_".concat(Date.now(),"_").concat(Math.random().toString(36).slice(2,11))}log(e,o,t,r,s){if(e<this.config.level)return;if(this.config.enableDeduplication){let r="".concat(e,"-").concat(o,"-").concat(t);if(this.loggedMessages.has(r))return;if(this.loggedMessages.add(r),this.loggedMessages.size>500){let e=Array.from(this.loggedMessages);this.loggedMessages.clear(),e.slice(-250).forEach(e=>this.loggedMessages.add(e))}}let a={timestamp:new Date().toISOString(),level:e,levelName:n[e],message:t,module:o,userId:this.userId,sessionId:this.sessionId,metadata:r,error:s,stack:null==s?void 0:s.stack,url:window.location.href,userAgent:navigator.userAgent};this.config.enableConsole&&this.consoleLog(a),this.config.enableLocalStorage&&this.saveToLocalStorage(a),this.config.enableRemote&&this.sendToRemote(a),this.logBuffer.push(a),this.logBuffer.length>100&&this.logBuffer.shift()}consoleLog(e){let o=this.getConsoleStyle(e.level),t="[".concat(e.levelName,"] [").concat(e.module,"]");this.config.verbose?(console.groupCollapsed("%c".concat(t," ").concat(e.message),o),console.log("Timestamp:",e.timestamp),console.log("Session:",e.sessionId),e.userId&&console.log("User:",e.userId),e.metadata&&console.log("Metadata:",e.metadata),e.error&&console.error("Error:",e.error),e.stack&&console.log("Stack:",e.stack),console.log("URL:",e.url),console.groupEnd()):this.getConsoleFunction(e.level)("%c".concat(t),o,e.message,e.metadata||"")}getConsoleStyle(e){switch(e){case 0:return"color: #6B7280; font-weight: normal;";case 1:return"color: #3B82F6; font-weight: normal;";case 2:return"color: #F59E0B; font-weight: bold;";case 3:return"color: #EF4444; font-weight: bold;";case 4:return"color: #FFFFFF; background-color: #DC2626; font-weight: bold; padding: 2px 4px;";default:return""}}getConsoleFunction(e){switch(e){case 0:return console.debug;case 1:return console.info;case 2:return console.warn;case 3:case 4:return console.error;default:return console.log}}saveToLocalStorage(e){try{let o=this.getLocalStorageLogs();o.push(e),o.length>this.config.maxLocalStorageLogs&&o.splice(0,o.length-this.config.maxLocalStorageLogs),localStorage.setItem("app_logs",JSON.stringify(o))}catch(e){console.error("Failed to save log to localStorage:",e)}}getLocalStorageLogs(){try{let e=localStorage.getItem("app_logs");return e?JSON.parse(e):[]}catch(e){return console.error("Failed to get logs from localStorage:",e),[]}}clearLocalStorageLogs(){localStorage.removeItem("app_logs"),this.info("Logger","Local storage logs cleared")}async sendToRemote(e){if(this.config.remoteEndpoint)try{await fetch(this.config.remoteEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}catch(e){console.error("Failed to send log to remote:",e)}}debug(e,o,t){this.log(0,e,o,t)}info(e,o,t){this.log(1,e,o,t)}warn(e,o,t){this.log(2,e,o,t)}error(e,o,t,r){this.log(3,e,o,r,t)}fatal(e,o,t,r){this.log(4,e,o,r,t)}time(e){this.timers.set(e,performance.now()),this.debug("Performance","Timer started: ".concat(e))}timeEnd(e,o){let t=this.timers.get(e);if(!t)return void this.warn("Performance","Timer not found: ".concat(e));let r=performance.now()-t;this.timers.delete(e);let n=r>this.config.performanceThreshold?2:1;return this.log(n,"Performance","Timer ended: ".concat(e),{...o,duration:"".concat(r.toFixed(2),"ms"),durationMs:r}),r}group(e,o){this.config.enableConsole&&this.config.verbose&&console.group("[".concat(e,"] ").concat(o)),this.debug(e,"Group started: ".concat(o))}groupEnd(e,o){this.config.enableConsole&&this.config.verbose&&console.groupEnd(),this.debug(e,"Group ended: ".concat(o))}table(e,o,t){this.config.enableConsole&&console.table(o,t),this.info(e,"Table data",{data:o,columns:t})}logApiRequest(e,o,t,r){let n=this.generateRequestId();return this.info("API","".concat(e," ").concat(o),{requestId:n,method:e,url:o,data:t,headers:r}),n}logApiResponse(e,o,t,r){this.log(o>=400?3:1,"API","Response ".concat(o),{requestId:e,status:o,data:t,duration:r?"".concat(r,"ms"):void 0})}logApiError(e,o){this.error("API","Request failed",o,{requestId:e})}logWsConnect(e){this.info("WebSocket","Connected to ".concat(e))}logWsDisconnect(e,o){this.warn("WebSocket","Disconnected from ".concat(e),{reason:o})}logWsMessage(e,o){this.debug("WebSocket","Message ".concat(e),{data:o})}logWsError(e){this.error("WebSocket","WebSocket error",e)}logUserAction(e,o,t){this.info("UserAction",e,{target:o,...t})}logPagePerformance(){if(!window.performance)return;let e=window.performance.timing,o=e.loadEventEnd-e.navigationStart,t=e.responseEnd-e.requestStart,r=e.domComplete-e.domLoading;this.info("Performance","Page performance metrics",{pageLoadTime:"".concat(o,"ms"),connectTime:"".concat(t,"ms"),renderTime:"".concat(r,"ms"),domContentLoaded:"".concat(e.domContentLoadedEventEnd-e.navigationStart,"ms")})}setupGlobalErrorHandler(){window.addEventListener("error",e=>{this.error("Global","Uncaught error",e.error||Error(e.message),{filename:e.filename,lineno:e.lineno,colno:e.colno})}),window.addEventListener("unhandledrejection",e=>{this.error("Global","Unhandled promise rejection",Error(e.reason),{reason:e.reason})})}setupPerformanceObserver(){if(window.PerformanceObserver)try{new PerformanceObserver(e=>{for(let o of e.getEntries())o.duration>50&&this.warn("Performance","Long task detected",{duration:"".concat(o.duration.toFixed(2),"ms"),name:o.name,startTime:o.startTime})}).observe({entryTypes:["longtask"]}),new PerformanceObserver(e=>{for(let o of e.getEntries())o.duration>this.config.performanceThreshold&&this.warn("Performance","Slow resource loading",{name:o.name,duration:"".concat(o.duration.toFixed(2),"ms"),type:o.initiatorType})}).observe({entryTypes:["resource"]})}catch(e){console.warn("Failed to setup performance observer:",e)}}getStats(){let e=this.getLocalStorageLogs(),o={total:e.length,debug:0,info:0,warn:0,error:0,fatal:0,modules:new Set,recentErrors:[]};for(let t of e){switch(t.level){case 0:o.debug++;break;case 1:o.info++;break;case 2:o.warn++;break;case 3:o.error++;break;case 4:o.fatal++}t.module&&o.modules.add(t.module),t.level>=3&&o.recentErrors.push(t)}return o.recentErrors=o.recentErrors.slice(-10),o}exportLogs(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"json",o=this.getLocalStorageLogs();return"json"===e?JSON.stringify(o,null,2):["timestamp,level,module,message,userId,sessionId,url",...o.map(e=>[e.timestamp,e.levelName,e.module||"",e.message,e.userId||"",e.sessionId,e.url||""]).map(e=>e.map(e=>'"'.concat(e,'"')).join(","))].join("\n")}logWalletConnection(e,o){this.info("Wallet","Connected: ".concat(e),{address:e,chainId:o})}logWalletDisconnection(){this.info("Wallet","Disconnected")}logTransactionStart(e,o){this.info("Transaction","Started: ".concat(o),{hash:e,type:o})}logTransactionSuccess(e,o){this.info("Transaction","Success: ".concat(o),{hash:e,type:o})}logTransactionError(e,o){this.error("Transaction","Failed: ".concat(o),e,{type:o})}logContractCall(e,o,t){this.debug("Contract","Call: ".concat(e,".").concat(o),{contractName:e,method:o,args:t})}clearDeduplicationCache(){this.loggedMessages.clear(),this.debug("Logger","Deduplication cache cleared")}constructor(){this.config={level:3,enableConsole:!0,enableRemote:!0,enableLocalStorage:!1,maxLocalStorageLogs:1e3,verbose:!1,performanceThreshold:1e3,enableDeduplication:!0,environment:"production"},this.logBuffer=[],this.timers=new Map,this.loggedMessages=new Set,this.sessionId=this.generateSessionId(),this.loadConfig(),this.setupGlobalErrorHandler(),this.setupPerformanceObserver()}}let a=new s;var i=t(88574),c=t(37811);let l=()=>t.e(4078).then(t.bind(t,84078)).then(e=>e.default),g=c.env.NEXT_PUBLIC_API_URL||"http://localhost:3001/api",d=r.A.create({baseURL:g,timeout:1e4,headers:{"Content-Type":"application/json"}});d.interceptors.request.use(e=>{var o;let t=i.b.getAccessToken();t&&(e.headers.Authorization="Bearer ".concat(t));let r=a.logApiRequest((null==(o=e.method)?void 0:o.toUpperCase())||"GET",e.url||"",e.data,e.headers);return e.headers["X-Request-Id"]=r,e.requestStartTime=Date.now(),e.requestId=r,e},async e=>{throw a.error("API","Request interceptor error",e),e}),d.interceptors.response.use(e=>{let o=e.config,t=o.requestStartTime?Date.now()-o.requestStartTime:void 0;return a.logApiResponse(o.requestId||"unknown",e.status,e.data,t),e},async e=>{var o,t,n,s;let c=e.config;if((null==(o=e.response)?void 0:o.status)===401&&!c._retry){c._retry=!0;let e=i.b.getRefreshToken();if(e)try{let{accessToken:o}=(await r.A.post("".concat(g,"/auth/refresh"),{refreshToken:e})).data;return i.b.setTokens(o,e),c.headers.Authorization="Bearer ".concat(o),d(c)}catch(o){i.b.clearTokens();let e=await l();return e&&e.error("登录已过期，请重新登录"),window.location.href="/auth/login",Promise.reject(o)}i.b.clearTokens(),window.location.href="/auth/login"}let h=(null==(n=e.response)||null==(t=n.data)?void 0:t.message)||e.message||"请求失败",u=e.config;if((null==u?void 0:u.requestId)&&a.logApiError(u.requestId,e),![401,403].includes((null==(s=e.response)?void 0:s.status)||0)){let e=await l();e&&e.error(h)}throw e});let h={login:async e=>d.post("/auth/login",e),register:async e=>d.post("/auth/register",e),getWeb3Challenge:async e=>d.get("/auth/web3/challenge/".concat(e)),web3Login:async e=>d.post("/auth/web3/login",e),web3Register:async e=>d.post("/auth/web3/register",e),refresh:async e=>d.post("/auth/refresh",{refreshToken:e}),logout:async()=>d.post("/auth/logout"),me:async()=>d.get("/auth/me"),changePassword:async e=>d.post("/auth/change-password",e)},u={getMetrics:async e=>d.get("/monitoring/metrics",{params:e}),getDashboard:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"24h";return d.get("/monitoring/dashboard",{params:{timeRange:e}})},getDeprecations:async()=>d.get("/monitoring/deprecations")},f=d}}]);