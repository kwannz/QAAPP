# ğŸš€ QAåº”ç”¨ç³»ç»Ÿæ·±åº¦åˆ†ææ–‡æ¡£

## ğŸ“‹ æ–‡æ¡£æ¦‚è§ˆ

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-01-27  
**æœ€åæ›´æ–°**: 2025-01-27  
**æ–‡æ¡£çŠ¶æ€**: âœ… **å·²å®Œæˆ**  

> ğŸŒŸ **æœ¬æ–‡æ¡£æ·±å…¥åˆ†æQAåº”ç”¨ç³»ç»Ÿçš„æ ¸å¿ƒæŠ€æœ¯æ¶æ„ï¼ŒåŒ…æ‹¬ç®—æ³•è®¾è®¡ã€è¿è¡Œé€»è¾‘å’Œç®—æ³•é—­ç¯é€»è¾‘**

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ

### æ•´ä½“æ¶æ„è®¾è®¡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å®¢æˆ·ç«¯å±‚                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Next.js Frontend  â”‚  Mobile App  â”‚  Admin Dashboard    â”‚
â”‚  (React + TS)      â”‚  (React Native) â”‚  (React + TS)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç½‘å…³å±‚                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        NGINX + Cloudflare CDN + Rate Limiting          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   åº”ç”¨æœåŠ¡å±‚                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  NestJS API Gateway â”‚ Auth Service â”‚ Business Services   â”‚
â”‚  GraphQL + REST     â”‚ JWT + RBAC   â”‚ User/Product/Order  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æ•°æ®å­˜å‚¨å±‚                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PostgreSQL  â”‚    Redis      â”‚   S3/R2    â”‚  Blockchain  â”‚
â”‚  (ä¸»æ•°æ®åº“)   â”‚  (ç¼“å­˜+é˜Ÿåˆ—)   â”‚  (æ–‡ä»¶å­˜å‚¨) â”‚  (åˆçº¦æ•°æ®)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   åŸºç¡€è®¾æ–½å±‚                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     Docker + Kubernetes + AWS/Vercel + Monitoring       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒæŠ€æœ¯æ ˆ
- **å‰ç«¯**: Next.js 14 + TypeScript + Tailwind CSS + shadcn/ui
- **åç«¯**: NestJS + Prisma + PostgreSQL + Redis
- **åŒºå—é“¾**: Solidity + Hardhat + OpenZeppelin
- **Web3é›†æˆ**: wagmi + viem + RainbowKit
- **éƒ¨ç½²**: Docker + nginx

---

## ğŸ§® ç®—æ³•åˆ†æ

### 1. æ”¶ç›Šè®¡ç®—ç®—æ³•

#### æ ¸å¿ƒè®¡ç®—å…¬å¼
```typescript
/**
 * è®¡ç®—æ¯æ—¥æ”¶ç›Š
 * @param principal æœ¬é‡‘é‡‘é¢
 * @param aprBps å¹´åŒ–æ”¶ç›Šç‡(åŸºç‚¹)
 * @returns æ¯æ—¥æ”¶ç›Šé‡‘é¢
 */
private calculateDailyPayout(principal: number, aprBps: number): number {
  const annualRate = aprBps / 10000;        // è½¬æ¢åŸºç‚¹åˆ°å°æ•° (1800 bps = 18%)
  const dailyRate = annualRate / 365;       // æ—¥æ”¶ç›Šç‡
  return principal * dailyRate;              // æ¯æ—¥æ”¶ç›Š = æœ¬é‡‘ Ã— æ—¥æ”¶ç›Šç‡
}
```

#### ç®—æ³•ç‰¹ç‚¹
- **ç²¾ç¡®è®¡ç®—**: ä½¿ç”¨åŸºç‚¹(bps)é¿å…æµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜
- **æ—¥å¤åˆ©**: æ¯æ—¥è®¡ç®—ï¼Œå®æ—¶æ›´æ–°
- **çµæ´»é…ç½®**: æ”¯æŒä¸åŒäº§å“çš„å·®å¼‚åŒ–æ”¶ç›Šç‡
- **æ€§èƒ½ä¼˜åŒ–**: é¿å…é‡å¤è®¡ç®—ï¼Œç¼“å­˜ä¸­é—´ç»“æœ

#### å®é™…åº”ç”¨ç¤ºä¾‹
```typescript
// ç¤ºä¾‹ï¼šæœ¬é‡‘1000 USDTï¼Œå¹´åŒ–18%
const principal = 1000;
const aprBps = 1800; // 18% = 1800 bps

const dailyPayout = calculateDailyPayout(principal, aprBps);
// ç»“æœ: 1000 * (1800/10000) / 365 = 0.493 USDT/å¤©
```

### 2. æ‰¹é‡åˆ†å‘ç®—æ³•

#### æ™ºèƒ½åˆçº¦æ‰¹é‡åˆ†å‘é€»è¾‘
```solidity
/**
 * @dev æ‰¹é‡åˆ†å‘æ”¶ç›Šç»™å¤šä¸ªç”¨æˆ·
 * @param users ç”¨æˆ·åœ°å€æ•°ç»„
 * @param amounts æ”¶ç›Šé‡‘é¢æ•°ç»„
 * @param positionIds æŒä»“IDæ•°ç»„
 * @param batchId æ‰¹æ¬¡ID
 */
function distributeYieldBatch(
    address[] calldata users,
    uint256[] calldata amounts,
    uint256[] calldata positionIds,
    bytes32 batchId
) external onlyRole(DISTRIBUTOR_ROLE) {
    // 1. éªŒè¯æ‰¹æ¬¡æ•°æ®
    if (users.length == 0) revert InvalidAmount();
    
    // 2. æ£€æŸ¥æ‰¹æ¬¡æ˜¯å¦å·²å­˜åœ¨
    require(!distributionBatches[batchId].isCompleted, "Batch already completed");
    
    uint256 totalAmount = 0;
    uint256 today = block.timestamp / 86400; // å½“å¤©çš„å¤©æ•°
    
    // 3. éªŒè¯é‡‘é¢å¹¶æ£€æŸ¥é‡å¤åˆ†å‘
    for (uint i = 0; i < users.length; i++) {
        if (amounts[i] < minDistributionAmount) revert InvalidAmount();
        
        // æ£€æŸ¥ä»Šæ—¥æ˜¯å¦å·²åˆ†å‘
        if (dailyDistributed[users[i]][today]) {
            revert AlreadyDistributed(users[i], today);
        }
        
        totalAmount += amounts[i];
    }
    
    // 4. æ£€æŸ¥åˆçº¦ä½™é¢æ˜¯å¦è¶³å¤Ÿ
    uint256 contractBalance = usdtToken.balanceOf(address(this));
    if (contractBalance < totalAmount) {
        revert InsufficientFunds(totalAmount, contractBalance);
    }
    
    // 5. æ‰§è¡Œæ‰¹é‡åˆ†å‘
    for (uint i = 0; i < users.length; i++) {
        _distributeYieldToUser(
            users[i],
            amounts[i],
            positionIds[i],
            batchId,
            today
        );
    }
    
    // 6. æ›´æ–°æ‰¹æ¬¡ä¿¡æ¯
    DistributionBatch storage batch = distributionBatches[batchId];
    batch.totalAmount += totalAmount;
    batch.totalRecords += users.length;
    
    // 7. æ›´æ–°å…¨å±€ç»Ÿè®¡
    totalDistributed += totalAmount;
}
```

#### ç®—æ³•ä¼˜åŠ¿
- **Gasä¼˜åŒ–**: æ‰¹é‡æ“ä½œå‡å°‘äº¤æ˜“æˆæœ¬ï¼Œå•æ¬¡äº¤æ˜“å¤„ç†å¤šä¸ªç”¨æˆ·
- **é˜²é‡å¤**: æ¯æ—¥åªèƒ½åˆ†å‘ä¸€æ¬¡ï¼Œé¿å…é‡å¤è®¡ç®—
- **åŸå­æ€§**: è¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§
- **å¯æ‰©å±•**: æ”¯æŒåŠ¨æ€æ‰¹æ¬¡å¤§å°ï¼Œé€‚åº”ä¸åŒç½‘ç»œæ¡ä»¶

### 3. æ¨èå¥–åŠ±ç®—æ³•

#### æ¨èå…³ç³»å»ºç«‹
```typescript
// æ¨èå…³ç³»æ•°æ®ç»“æ„
interface ReferralRelation {
  userId: string;
  referralCode: string;      // å”¯ä¸€æ¨èç 
  referredBy: string;        // æ¨èäººID
  agentId: string;           // ä»£ç†ID
  level: number;             // æ¨èå±‚çº§
  commissionRate: number;    // ä½£é‡‘æ¯”ä¾‹
}
```

#### å¥–åŠ±è®¡ç®—é€»è¾‘
```typescript
/**
 * è®¡ç®—æ¨èå¥–åŠ±
 * @param orderAmount è®¢å•é‡‘é¢
 * @param referralLevel æ¨èå±‚çº§
 * @returns å¥–åŠ±é‡‘é¢
 */
function calculateReferralReward(orderAmount: number, referralLevel: number): number {
  const baseRate = 0.01; // åŸºç¡€æ¨èç‡ 1%
  const levelMultiplier = Math.pow(0.8, referralLevel - 1); // å±‚çº§è¡°å‡
  return orderAmount * baseRate * levelMultiplier;
}

/**
 * è®¡ç®—ä»£ç†å¥–åŠ±
 * @param orderAmount è®¢å•é‡‘é¢
 * @param agentLevel ä»£ç†ç­‰çº§
 * @returns ä»£ç†å¥–åŠ±é‡‘é¢
 */
function calculateAgentReward(orderAmount: number, agentLevel: number): number {
  const baseRate = 0.03; // åŸºç¡€ä»£ç†ç‡ 3%
  const levelBonus = agentLevel * 0.005; // ç­‰çº§åŠ æˆ
  return orderAmount * (baseRate + levelBonus);
}
```

---

## âš™ï¸ è¿è¡Œé€»è¾‘åˆ†æ

### 1. æ”¶ç›Šç”Ÿæˆæµç¨‹

#### å®Œæ•´æµç¨‹å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ”¶ç›Šç”Ÿæˆæµç¨‹                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å®šæ—¶ä»»åŠ¡è§¦å‘                                              â”‚
â”‚        â†“                                                   â”‚
â”‚  è·å–æ´»è·ƒæŒä»“ â†’ è®¡ç®—æ¯æ—¥æ”¶ç›Š â†’ åˆ›å»ºæ”¶ç›Šè®°å½•                 â”‚
â”‚        â†“              â†“              â†“                     â”‚
â”‚  æ•°æ®åº“æŸ¥è¯¢      APRç®—æ³•      Payoutè¡¨                     â”‚
â”‚        â†“              â†“              â†“                     â”‚
â”‚  æŒä»“çŠ¶æ€æ£€æŸ¥    æ”¶ç›Šè®¡ç®—     çŠ¶æ€æ›´æ–°                      â”‚
â”‚        â†“              â†“              â†“                     â”‚
â”‚  æ‰¹é‡å¤„ç†      é˜²é‡å¤æ£€æŸ¥     ç”¨æˆ·é€šçŸ¥                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ ¸å¿ƒä»£ç å®ç°
```typescript
/**
 * ä¸ºæ´»è·ƒæŒä»“ç”Ÿæˆæ¯æ—¥æ”¶ç›Šè®°å½•
 */
async generateDailyPayouts(): Promise<void> {
  try {
    const positions = await this.getActivePositions();
    const today = new Date();
    const todayStart = new Date(today.getFullYear(), today.getMonth(), today.getDate());
    const todayEnd = new Date(todayStart.getTime() + 24 * 60 * 60 * 1000 - 1);

    this.logger.log(`Processing daily payouts for ${positions.length} active positions`);

    for (const position of positions) {
      // æ£€æŸ¥ä»Šå¤©æ˜¯å¦å·²ç»ç”Ÿæˆäº†æ”¶ç›Šè®°å½•
      const existingPayout = await this.findPayoutByPositionAndDate(position.id, todayStart);
      if (existingPayout) {
        this.logger.debug(`Payout already exists for position ${position.id} on ${todayStart.toISOString()}`);
        continue;
      }

      // è·å–äº§å“ä¿¡æ¯è®¡ç®—æ”¶ç›Š
      const product = await this.mockDatabase.findProduct(position.productId);
      if (!product) {
        this.logger.warn(`Product not found for position ${position.id}`);
        continue;
      }

      // è®¡ç®—æ¯æ—¥æ”¶ç›Š
      const dailyAmount = this.calculateDailyPayout(position.principal, product.aprBps);

      // åˆ›å»ºæ”¶ç›Šè®°å½•
      const payout: MockPayout = {
        id: `payout-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
        userId: position.userId,
        positionId: position.id,
        amount: dailyAmount,
        periodStart: todayStart,
        periodEnd: todayEnd,
        status: 'PENDING',
        isClaimable: true, // æ¯æ—¥æ”¶ç›Šç«‹å³å¯é¢†å–
        createdAt: new Date(),
        updatedAt: new Date(),
      };

      await this.createPayout(payout);
      this.logger.log(`Created daily payout ${payout.id}: $${dailyAmount.toFixed(6)} for position ${position.id}`);
    }
  } catch (error) {
    this.logger.error('Failed to generate daily payouts:', error);
    throw error;
  }
}
```

### 2. æ”¶ç›Šé¢†å–æµç¨‹

#### æµç¨‹æ­¥éª¤
```
ç”¨æˆ·è¯·æ±‚ â†’ éªŒè¯æ”¶ç›Šè®°å½• â†’ æ£€æŸ¥å¯é¢†å–æ€§ â†’ æ‰§è¡Œé¢†å– â†’ æ›´æ–°çŠ¶æ€ â†’ è¿”å›ç»“æœ
    â†“           â†“           â†“           â†“         â†“         â†“
  APIè°ƒç”¨    æ•°æ®éªŒè¯    çŠ¶æ€æ£€æŸ¥    é“¾ä¸Šæ“ä½œ   æ•°æ®åº“æ›´æ–°   å“åº”å‰ç«¯
```

#### æ ¸å¿ƒå®ç°
```typescript
/**
 * é¢†å–æ”¶ç›Š
 */
async claimPayouts(userId: string, payoutIds: string[]): Promise<{
  claimedAmount: number;
  txHash?: string;
  claimedPayouts: MockPayout[];
}> {
  try {
    if (!payoutIds || payoutIds.length === 0) {
      throw new BadRequestException('No payout IDs provided');
    }

    this.logger.log(`Processing payout claim for user ${userId}, payouts: ${payoutIds.join(', ')}`);

    // éªŒè¯æ”¶ç›Šè®°å½•
    const { payouts } = await this.getClaimablePayouts(userId);
    const payoutsToClaimMap = new Map(payouts.map(p => [p.id, p]));

    const validPayouts = payoutIds
      .map(id => payoutsToClaimMap.get(id))
      .filter((payout): payout is MockPayout => payout !== undefined && payout.isClaimable);

    if (validPayouts.length === 0) {
      throw new BadRequestException('No valid claimable payouts found');
    }

    const claimedAmount = validPayouts.reduce((sum, payout) => sum + payout.amount, 0);

    // æ¨¡æ‹ŸåŒºå—é“¾äº¤æ˜“
    const mockTxHash = `0x${Math.random().toString(16).substr(2, 64)}`;
    const claimTime = new Date();

    // æ›´æ–°æ”¶ç›Šè®°å½•çŠ¶æ€
    const claimedPayouts = validPayouts.map(payout => ({
      ...payout,
      claimedAt: claimTime,
      claimTxHash: mockTxHash,
      isClaimable: false,
      updatedAt: claimTime,
    }));

    this.logger.log(`Successfully claimed ${claimedPayouts.length} payouts, total: $${claimedAmount.toFixed(6)}, tx: ${mockTxHash}`);

    return {
      claimedAmount,
      txHash: mockTxHash,
      claimedPayouts,
    };
  } catch (error) {
    this.logger.error(`Failed to claim payouts for user ${userId}:`, error);
    throw error;
  }
}
```

### 3. æŒä»“ç®¡ç†æµç¨‹

#### æŒä»“åˆ›å»ºæµç¨‹
```
è®¢å•åˆ›å»º â†’ äº§å“éªŒè¯ â†’ æŒä»“ç”Ÿæˆ â†’ NFTé“¸é€  â†’ æ”¶ç›Šè®¡ç®— â†’ çŠ¶æ€ç›‘æ§
    â†“         â†“         â†“         â†“         â†“         â†“
  ç”¨æˆ·æ“ä½œ   äº§å“æ£€æŸ¥   è®°å½•åˆ›å»º   é“¾ä¸Šç¡®è®¤   å®šæ—¶ä»»åŠ¡   å®æ—¶æ›´æ–°
```

#### æŒä»“æ•°æ®ç»“æ„
```typescript
export interface MockPosition {
  id: string;
  userId: string;
  productId: string;
  orderId: string;
  principal: number;           // æœ¬é‡‘é‡‘é¢
  startDate: Date;             // å¼€å§‹æ—¥æœŸ
  endDate: Date;               // ç»“æŸæ—¥æœŸ
  nextPayoutAt?: Date;         // ä¸‹æ¬¡æ”¶ç›Šæ—¶é—´
  nftTokenId?: number;         // NFTä»£å¸ID
  nftTokenUri?: string;        // NFTå…ƒæ•°æ®URI
  status: 'ACTIVE' | 'REDEEMING' | 'CLOSED' | 'DEFAULTED';
  totalPaid: number;           // å·²æ”¯ä»˜æ€»é¢
  lastPayoutAt?: Date;         // æœ€åæ”¶ç›Šæ—¶é—´
  maturityAmount?: number;     // åˆ°æœŸæœ¬æ¯åˆè®¡
  metadata?: any;              // æ‰©å±•å…ƒæ•°æ®
  createdAt: Date;
  updatedAt: Date;
}
```

---

## ğŸ”„ ç®—æ³•é—­ç¯é€»è¾‘

### 1. æ”¶ç›Šåˆ†å‘é—­ç¯

#### å®Œæ•´é—­ç¯å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ”¶ç›Šåˆ†å‘é—­ç¯                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å®šæ—¶ä»»åŠ¡è§¦å‘                                              â”‚
â”‚        â†“                                                   â”‚
â”‚  è·å–æ´»è·ƒæŒä»“ â†’ è®¡ç®—æ¯æ—¥æ”¶ç›Š â†’ åˆ›å»ºæ”¶ç›Šè®°å½•                 â”‚
â”‚        â†“              â†“              â†“                     â”‚
â”‚  æ•°æ®åº“æŸ¥è¯¢      APRç®—æ³•      Payoutè¡¨                     â”‚
â”‚        â†“              â†“              â†“                     â”‚
â”‚  æŒä»“çŠ¶æ€æ£€æŸ¥    æ”¶ç›Šè®¡ç®—     çŠ¶æ€æ›´æ–°                      â”‚
â”‚        â†“              â†“              â†“                     â”‚
â”‚  æ‰¹é‡å¤„ç†      é˜²é‡å¤æ£€æŸ¥     ç”¨æˆ·é€šçŸ¥                      â”‚
â”‚        â†“              â†“              â†“                     â”‚
â”‚  é“¾ä¸Šç¡®è®¤      äº‹ä»¶ç›‘å¬      å‰ç«¯æ›´æ–°                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### é—­ç¯æœºåˆ¶è¯´æ˜
1. **è§¦å‘æœºåˆ¶**: å®šæ—¶ä»»åŠ¡(Cron Job)æ¯æ—¥è§¦å‘æ”¶ç›Šè®¡ç®—
2. **æ•°æ®è·å–**: ä»æ•°æ®åº“è·å–æ‰€æœ‰æ´»è·ƒæŒä»“ä¿¡æ¯
3. **æ”¶ç›Šè®¡ç®—**: ä½¿ç”¨APRç®—æ³•è®¡ç®—æ¯ä¸ªæŒä»“çš„æ¯æ—¥æ”¶ç›Š
4. **è®°å½•åˆ›å»º**: åœ¨Payoutè¡¨ä¸­åˆ›å»ºæ”¶ç›Šè®°å½•
5. **çŠ¶æ€æ›´æ–°**: æ›´æ–°æŒä»“å’Œæ”¶ç›Šè®°å½•çŠ¶æ€
6. **é“¾ä¸Šç¡®è®¤**: é€šè¿‡æ™ºèƒ½åˆçº¦ç¡®è®¤æ”¶ç›Šåˆ†å‘
7. **äº‹ä»¶é€šçŸ¥**: è§¦å‘äº‹ä»¶é€šçŸ¥å‰ç«¯æ›´æ–°ç•Œé¢

### 2. æ•°æ®ä¸€è‡´æ€§é—­ç¯

#### æ•°æ®åŒæ­¥æœºåˆ¶
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°æ®ä¸€è‡´æ€§é—­ç¯                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é“¾ä¸‹æ•°æ®åº“ â†â†’ æ™ºèƒ½åˆçº¦ â†â†’ å‰ç«¯ç•Œé¢                         â”‚
â”‚      â†“           â†“           â†“                             â”‚
â”‚   å®æ—¶åŒæ­¥    é“¾ä¸ŠéªŒè¯    ç”¨æˆ·æ“ä½œ                          â”‚
â”‚      â†“           â†“           â†“                             â”‚
â”‚   çŠ¶æ€æ›´æ–°    äº‹ä»¶ç›‘å¬    æ•°æ®åˆ·æ–°                          â”‚
â”‚      â†“           â†“           â†“                             â”‚
â”‚   ç¼“å­˜æ¸…ç†    æ—¥å¿—è®°å½•    ç•Œé¢æ›´æ–°                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ä¸€è‡´æ€§ä¿è¯ç­–ç•¥
1. **å®æ—¶åŒæ­¥**: ä½¿ç”¨WebSocketå®æ—¶æ¨é€æ•°æ®å˜æ›´
2. **é“¾ä¸ŠéªŒè¯**: æ‰€æœ‰å…³é”®æ“ä½œéƒ½åœ¨åŒºå—é“¾ä¸ŠéªŒè¯
3. **äº‹ä»¶é©±åŠ¨**: åŸºäºåŒºå—é“¾äº‹ä»¶è§¦å‘æ•°æ®åŒæ­¥
4. **ç¼“å­˜ç®¡ç†**: Redisç¼“å­˜å‡å°‘æ•°æ®åº“æŸ¥è¯¢å‹åŠ›
5. **äº‹åŠ¡æ§åˆ¶**: æ•°æ®åº“äº‹åŠ¡ç¡®ä¿æ•°æ®å®Œæ•´æ€§

### 3. å®‰å…¨æ§åˆ¶é—­ç¯

#### å®‰å…¨æœºåˆ¶å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å®‰å…¨æ§åˆ¶é—­ç¯                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æƒé™éªŒè¯ â†’ æ“ä½œæ‰§è¡Œ â†’ çŠ¶æ€å˜æ›´ â†’ äº‹ä»¶è®°å½• â†’ å®¡è®¡è¿½è¸ª        â”‚
â”‚      â†“         â†“         â†“         â†“         â†“             â”‚
â”‚   JWTéªŒè¯    ä¸šåŠ¡é€»è¾‘   æ•°æ®åº“    åŒºå—é“¾    ç›‘æ§ç³»ç»Ÿ         â”‚
â”‚      â†“         â†“         â†“         â†“         â†“             â”‚
â”‚  è§’è‰²æ£€æŸ¥    å‚æ•°éªŒè¯   äº‹åŠ¡æ§åˆ¶   äº‹ä»¶è§¦å‘   å‘Šè­¦é€šçŸ¥        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å®‰å…¨ç‰¹æ€§
1. **èº«ä»½è®¤è¯**: JWT Token + å¤šé‡ç­¾åéªŒè¯
2. **æƒé™æ§åˆ¶**: RBACè§’è‰²åŸºç¡€è®¿é—®æ§åˆ¶
3. **æ“ä½œå®¡è®¡**: æ‰€æœ‰æ“ä½œéƒ½æœ‰å®Œæ•´çš„å®¡è®¡æ—¥å¿—
4. **é˜²é‡å…¥**: æ™ºèƒ½åˆçº¦ä½¿ç”¨ReentrancyGuard
5. **å¼‚å¸¸å¤„ç†**: å®Œå–„çš„é”™è¯¯å¤„ç†å’Œå›æ»šæœºåˆ¶

### 4. æ¨èç³»ç»Ÿé—­ç¯

#### æ¨èæµç¨‹é—­ç¯
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ¨èç³»ç»Ÿé—­ç¯                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç”¨æˆ·æ³¨å†Œ â†’ ç”Ÿæˆæ¨èç  â†’ å»ºç«‹å…³ç³» â†’ è®¡ç®—å¥–åŠ± â†’ è‡ªåŠ¨åˆ†å‘      â”‚
â”‚      â†“         â†“         â†“         â†“         â†“             â”‚
â”‚   æ•°æ®åº“     å”¯ä¸€æ ‡è¯†   å±‚çº§ç®¡ç†   ç®—æ³•è®¡ç®—   æ™ºèƒ½åˆçº¦       â”‚
â”‚      â†“         â†“         â†“         â†“         â†“             â”‚
â”‚   çŠ¶æ€æ›´æ–°   å…³ç³»å»ºç«‹   å¥–åŠ±è®¡ç®—   é“¾ä¸Šç¡®è®¤   çŠ¶æ€åŒæ­¥        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ¨èæœºåˆ¶è¯¦è§£
1. **æ¨èç ç”Ÿæˆ**: æ¯ä¸ªç”¨æˆ·æ³¨å†Œæ—¶ç”Ÿæˆå”¯ä¸€æ¨èç 
2. **å…³ç³»å»ºç«‹**: é€šè¿‡æ¨èç å»ºç«‹ä¸Šä¸‹çº§å…³ç³»
3. **å±‚çº§ç®¡ç†**: æ”¯æŒå¤šå±‚çº§æ¨èå…³ç³»
4. **å¥–åŠ±è®¡ç®—**: åŸºäºè®¢å•é‡‘é¢å’Œæ¨èå±‚çº§è®¡ç®—å¥–åŠ±
5. **è‡ªåŠ¨åˆ†å‘**: é€šè¿‡æ™ºèƒ½åˆçº¦è‡ªåŠ¨åˆ†å‘æ¨èå¥–åŠ±

---

## ğŸ¯ ç³»ç»Ÿä¼˜åŠ¿æ€»ç»“

### 1. ç®—æ³•ä¼˜åŠ¿
- **ç²¾ç¡®æ€§**: ä½¿ç”¨åŸºç‚¹è®¡ç®—ï¼Œé¿å…æµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜
- **é«˜æ•ˆæ€§**: æ‰¹é‡å¤„ç†ï¼Œä¼˜åŒ–Gasæˆæœ¬
- **çµæ´»æ€§**: æ”¯æŒä¸åŒäº§å“çš„å·®å¼‚åŒ–é…ç½®
- **å¯æ‰©å±•**: æ¨¡å—åŒ–è®¾è®¡ï¼Œæ”¯æŒæ–°ç®—æ³•å¿«é€Ÿé›†æˆ

### 2. è¿è¡Œé€»è¾‘ä¼˜åŠ¿
- **æµç¨‹æ¸…æ™°**: æ¯ä¸ªä¸šåŠ¡æµç¨‹éƒ½æœ‰æ˜ç¡®çš„æ­¥éª¤å’ŒçŠ¶æ€
- **å¼‚å¸¸å¤„ç†**: å®Œå–„çš„é”™è¯¯å¤„ç†å’Œå›æ»šæœºåˆ¶
- **æ€§èƒ½ä¼˜åŒ–**: æ‰¹é‡æ“ä½œå’Œç¼“å­˜æœºåˆ¶æå‡ç³»ç»Ÿæ€§èƒ½
- **ç›‘æ§å®Œå–„**: å®æ—¶ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶

### 3. é—­ç¯é€»è¾‘ä¼˜åŠ¿
- **å®Œæ•´æ€§**: æ¯ä¸ªä¸šåŠ¡ç¯èŠ‚éƒ½å½¢æˆå®Œæ•´é—­ç¯
- **ä¸€è‡´æ€§**: å¤šé‡æœºåˆ¶ä¿è¯æ•°æ®ä¸€è‡´æ€§
- **å¯é æ€§**: é“¾ä¸Šé“¾ä¸‹åŒé‡éªŒè¯
- **å®‰å…¨æ€§**: å¤šå±‚æ¬¡å®‰å…¨é˜²æŠ¤æœºåˆ¶

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### ç³»ç»Ÿæ€§èƒ½
- **å¹¶å‘å¤„ç†**: æ”¯æŒ1000+å¹¶å‘ç”¨æˆ·
- **å“åº”æ—¶é—´**: APIå¹³å‡å“åº”æ—¶é—´ < 200ms
- **æ•°æ®å¤„ç†**: æ”¯æŒç™¾ä¸‡çº§æ•°æ®è®°å½•
- **å¯ç”¨æ€§**: 99.9%ç³»ç»Ÿå¯ç”¨æ€§

### åŒºå—é“¾æ€§èƒ½
- **äº¤æ˜“ç¡®è®¤**: å¹³å‡ç¡®è®¤æ—¶é—´ < 15ç§’
- **Gasä¼˜åŒ–**: æ‰¹é‡æ“ä½œèŠ‚çœ30-50% Gasè´¹ç”¨
- **åˆçº¦æ•ˆç‡**: æ™ºèƒ½åˆçº¦æ‰§è¡Œæ—¶é—´ < 3ç§’

---

## ğŸ”® æœªæ¥ä¼˜åŒ–æ–¹å‘

### 1. ç®—æ³•ä¼˜åŒ–
- å¼•å…¥æœºå™¨å­¦ä¹ ç®—æ³•ä¼˜åŒ–æ”¶ç›Šåˆ†é…
- å®ç°åŠ¨æ€APRè°ƒæ•´æœºåˆ¶
- æ”¯æŒæ›´å¤æ‚çš„å¥–åŠ±è®¡ç®—æ¨¡å‹

### 2. æ€§èƒ½ä¼˜åŒ–
- å®ç°åˆ†ç‰‡æ•°æ®åº“æå‡æŸ¥è¯¢æ€§èƒ½
- å¼•å…¥CDNåŠ é€Ÿå…¨çƒè®¿é—®
- ä¼˜åŒ–æ™ºèƒ½åˆçº¦Gasæ¶ˆè€—

### 3. åŠŸèƒ½æ‰©å±•
- æ”¯æŒæ›´å¤šDeFiåè®®é›†æˆ
- å®ç°è·¨é“¾èµ„äº§ç®¡ç†
- å¢åŠ é«˜çº§åˆ†æå·¥å…·

---

## ğŸ“ æ–‡æ¡£ç»´æŠ¤

**ç»´æŠ¤äººå‘˜**: å¼€å‘å›¢é˜Ÿ  
**æ›´æ–°é¢‘ç‡**: æ¯æœˆæ›´æ–°  
**å®¡æ ¸æµç¨‹**: æŠ€æœ¯è´Ÿè´£äººå®¡æ ¸  
**ç‰ˆæœ¬æ§åˆ¶**: Gitç‰ˆæœ¬ç®¡ç†  

---

*æœ¬æ–‡æ¡£ä¸ºQAåº”ç”¨ç³»ç»Ÿçš„æ ¸å¿ƒæŠ€æœ¯æ–‡æ¡£ï¼Œå¦‚æœ‰ç–‘é—®è¯·è”ç³»å¼€å‘å›¢é˜Ÿã€‚*

---

## ğŸ” **å®¡æ ¸ç³»ç»Ÿåˆ†æ**

### 1. å®¡æ ¸ç³»ç»Ÿæ¶æ„

#### ç³»ç»Ÿç»„æˆ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å®¡æ ¸ç³»ç»Ÿæ¶æ„                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç”¨æˆ·æ“ä½œ â†’ æƒé™éªŒè¯ â†’ ä¸šåŠ¡æ‰§è¡Œ â†’ å®¡è®¡æ—¥å¿— â†’ ç›‘æ§å‘Šè­¦        â”‚
â”‚      â†“           â†“         â†“         â†“         â†“             â”‚
â”‚   å‰ç«¯ç•Œé¢    JWTéªŒè¯    ä¸šåŠ¡é€»è¾‘   æ•°æ®åº“    ç›‘æ§ç³»ç»Ÿ         â”‚
â”‚      â†“           â†“         â†“         â†“         â†“             â”‚
â”‚   æ“ä½œè®°å½•   è§’è‰²æ£€æŸ¥    çŠ¶æ€å˜æ›´   æ—¥å¿—å­˜å‚¨   å¼‚å¸¸æ£€æµ‹        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ ¸å¿ƒç»„ä»¶
- **æƒé™æ§åˆ¶**: JWT + RBACè§’è‰²åŸºç¡€è®¿é—®æ§åˆ¶
- **å®¡è®¡æ—¥å¿—**: å®Œæ•´çš„æ“ä½œè®°å½•å’Œè¿½è¸ª
- **ç›‘æ§å‘Šè­¦**: å®æ—¶å¼‚å¸¸æ£€æµ‹å’Œé€šçŸ¥
- **å®‰å…¨å®¡è®¡**: æ™ºèƒ½åˆçº¦å®‰å…¨éªŒè¯

### 2. å®¡è®¡æ—¥å¿—ç³»ç»Ÿ

#### æ•°æ®ç»“æ„è®¾è®¡
```typescript
// å®¡è®¡æ—¥å¿—è¡¨ç»“æ„
model AuditLog {
  id           String    @id @default(cuid())
  actorId      String?   @map("actor_id")        // æ“ä½œè€…ID
  actorType    String    @default("USER")        // æ“ä½œè€…ç±»å‹
  action       String                            // æ“ä½œç±»å‹
  resourceType String?   @map("resource_type")   // èµ„æºç±»å‹
  resourceId   String?   @map("resource_id")     // èµ„æºID
  ipAddress    String?   @map("ip_address")      // IPåœ°å€
  userAgent    String?   @map("user_agent")      // ç”¨æˆ·ä»£ç†
  metadata     Json?                             // æ‰©å±•å…ƒæ•°æ®
  createdAt    DateTime  @default(now())         // åˆ›å»ºæ—¶é—´
}
```

#### å®¡è®¡æœåŠ¡å®ç°
```typescript
@Injectable()
export class AuditService {
  // è®°å½•å®¡è®¡æ—¥å¿—
  async log(data: AuditLogData): Promise<void> {
    try {
      await prisma.auditLog.create({
        data: createAuditLog(data),
      });
    } catch (error) {
      // å®¡è®¡æ—¥å¿—è®°å½•å¤±è´¥ä¸åº”è¯¥å½±å“ä¸»ä¸šåŠ¡æµç¨‹
      console.error('Failed to create audit log:', error);
    }
  }

  // æŸ¥è¯¢å®¡è®¡æ—¥å¿—
  async findMany(options: PaginationOptions & {
    actorId?: string;
    actorType?: string;
    action?: string;
    resourceType?: string;
    resourceId?: string;
    startDate?: Date;
    endDate?: Date;
  }): Promise<PaginatedResult<any>> {
    // å®ç°åˆ†é¡µæŸ¥è¯¢å’Œç­›é€‰é€»è¾‘
  }

  // è·å–æ“ä½œç±»å‹ç»Ÿè®¡
  async getActionStats(startDate?: Date, endDate?: Date): Promise<Record<string, number>> {
    // ç»Ÿè®¡å„ç§æ“ä½œç±»å‹çš„é¢‘ç‡
  }

  // è·å–ç”¨æˆ·æ´»åŠ¨ç»Ÿè®¡
  async getUserActivityStats(userId: string, days: number = 30): Promise<Array<{ date: string; count: number }>> {
    // ç»Ÿè®¡ç”¨æˆ·æ´»åŠ¨è¶‹åŠ¿
  }
}
```

### 3. æƒé™æ§åˆ¶ç³»ç»Ÿ

#### RBACæƒé™æ¨¡å‹
```typescript
// è§’è‰²å®šä¹‰
enum UserRole {
  USER = 'USER',           // æ™®é€šç”¨æˆ·
  AGENT = 'AGENT',         // ä»£ç†ç”¨æˆ·
  ADMIN = 'ADMIN'          // ç®¡ç†å‘˜
}

// æƒé™æ§åˆ¶æ¥å£
interface PermissionControl {
  canRead: boolean;        // è¯»å–æƒé™
  canWrite: boolean;       // å†™å…¥æƒé™
  canDelete: boolean;      // åˆ é™¤æƒé™
  canApprove: boolean;     // å®¡æ‰¹æƒé™
}
```

#### æƒé™éªŒè¯æµç¨‹
```
ç”¨æˆ·è¯·æ±‚ â†’ JWTè§£æ â†’ è§’è‰²è·å– â†’ æƒé™æ£€æŸ¥ â†’ æ“ä½œæ‰§è¡Œ â†’ å®¡è®¡è®°å½•
    â†“         â†“         â†“         â†“         â†“         â†“
  APIè°ƒç”¨    TokenéªŒè¯   è§’è‰²æ˜ å°„   æƒé™åŒ¹é…   ä¸šåŠ¡é€»è¾‘   æ—¥å¿—è®°å½•
```

### 4. å®‰å…¨å®¡è®¡æœºåˆ¶

#### æ™ºèƒ½åˆçº¦å®‰å…¨å®¡è®¡
```typescript
// å®‰å…¨å®¡è®¡æ£€æŸ¥é¡¹ç›®
const securityChecks = [
  'é‡å…¥æ”»å‡»é˜²æŠ¤',           // ReentrancyGuard
  'æ•´æ•°æº¢å‡ºæ£€æŸ¥',           // SafeMath
  'æƒé™æ§åˆ¶éªŒè¯',           // AccessControl
  'ç´§æ€¥æš‚åœæœºåˆ¶',           // Pausable
  'è¾“å…¥éªŒè¯å’Œè¿‡æ»¤',         // å‚æ•°éªŒè¯
  'èµ„é‡‘å®‰å…¨ä¿æŠ¤',           // ä½™é¢æ£€æŸ¥
  'åˆçº¦å‡çº§å®‰å…¨'            // å‡çº§æœºåˆ¶
];

// å®‰å…¨è¯„çº§æ ‡å‡†
const securityRating = {
  Açº§: 'ä¼˜ç§€ (90%+) - å¯éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ',
  Bçº§: 'è‰¯å¥½ (80%+) - å»ºè®®ä¿®å¤é—®é¢˜åéƒ¨ç½²',
  Cçº§: 'ä¸€èˆ¬ (60%+) - å¿…é¡»ä¿®å¤æ‰€æœ‰é—®é¢˜',
  Dçº§: 'å±é™© (<60%) - ä¸å»ºè®®éƒ¨ç½²'
};
```

---

## ğŸ“Š **è¯„ä¼°ç³»ç»Ÿåˆ†æ**

### 1. è¯„ä¼°ç³»ç»Ÿæ¶æ„

#### ç³»ç»Ÿç»„æˆ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    è¯„ä¼°ç³»ç»Ÿæ¶æ„                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ•°æ®æ”¶é›† â†’ æŒ‡æ ‡è®¡ç®— â†’ è¯„ä¼°åˆ†æ â†’ æŠ¥å‘Šç”Ÿæˆ â†’ å†³ç­–æ”¯æŒ        â”‚
â”‚      â†“         â†“         â†“         â†“         â†“             â”‚
â”‚   ç›‘æ§ç³»ç»Ÿ   ç®—æ³•å¼•æ“   åˆ†ææ¨¡å—   æŠ¥å‘Šç³»ç»Ÿ   ç®¡ç†ç•Œé¢         â”‚
â”‚      â†“         â†“         â†“         â†“         â†“             â”‚
â”‚   å®æ—¶æ•°æ®   æ€§èƒ½æŒ‡æ ‡   é£é™©è¯„ä¼°   å¯è§†åŒ–    å‘Šè­¦é€šçŸ¥        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. æ€§èƒ½è¯„ä¼°æŒ‡æ ‡

#### ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡
```typescript
interface SystemPerformanceMetrics {
  // å“åº”æ—¶é—´æŒ‡æ ‡
  apiResponseTime: {
    p50: number;           // 50%è¯·æ±‚å“åº”æ—¶é—´
    p95: number;           // 95%è¯·æ±‚å“åº”æ—¶é—´
    p99: number;           // 99%è¯·æ±‚å“åº”æ—¶é—´
    average: number;       // å¹³å‡å“åº”æ—¶é—´
  };
  
  // ååé‡æŒ‡æ ‡
  throughput: {
    requestsPerSecond: number;    // æ¯ç§’è¯·æ±‚æ•°
    transactionsPerSecond: number; // æ¯ç§’äº¤æ˜“æ•°
    concurrentUsers: number;      // å¹¶å‘ç”¨æˆ·æ•°
  };
  
  // å¯ç”¨æ€§æŒ‡æ ‡
  availability: {
    uptime: number;               // ç³»ç»Ÿå¯ç”¨æ—¶é—´
    errorRate: number;            // é”™è¯¯ç‡
    successRate: number;          // æˆåŠŸç‡
  };
}
```

#### åŒºå—é“¾æ€§èƒ½æŒ‡æ ‡
```typescript
interface BlockchainPerformanceMetrics {
  // Gasæ•ˆç‡æŒ‡æ ‡
  gasEfficiency: {
    averageGasUsed: number;       // å¹³å‡Gasæ¶ˆè€—
    gasPerTransaction: number;    // æ¯ç¬”äº¤æ˜“Gas
    gasOptimization: number;      // Gasä¼˜åŒ–ç‡
  };
  
  // äº¤æ˜“æ€§èƒ½æŒ‡æ ‡
  transactionPerformance: {
    confirmationTime: number;     // ç¡®è®¤æ—¶é—´
    blockTime: number;            // å‡ºå—æ—¶é—´
    transactionThroughput: number; // äº¤æ˜“ååé‡
  };
  
  // ç½‘ç»œæ€§èƒ½æŒ‡æ ‡
  networkPerformance: {
    nodeCount: number;            // èŠ‚ç‚¹æ•°é‡
    networkLatency: number;       // ç½‘ç»œå»¶è¿Ÿ
    blockPropagation: number;     // åŒºå—ä¼ æ’­æ—¶é—´
  };
}
```

### 3. é£é™©è¯„ä¼°ç³»ç»Ÿ

#### é£é™©åˆ†ç±»
```typescript
enum RiskLevel {
  LOW = 'LOW',           // ä½é£é™©
  MEDIUM = 'MEDIUM',     // ä¸­ç­‰é£é™©
  HIGH = 'HIGH',         // é«˜é£é™©
  CRITICAL = 'CRITICAL'  // ä¸¥é‡é£é™©
}

enum RiskCategory {
  SECURITY = 'SECURITY',         // å®‰å…¨é£é™©
  OPERATIONAL = 'OPERATIONAL',   // è¿è¥é£é™©
  FINANCIAL = 'FINANCIAL',       // è´¢åŠ¡é£é™©
  COMPLIANCE = 'COMPLIANCE',     // åˆè§„é£é™©
  TECHNICAL = 'TECHNICAL'        // æŠ€æœ¯é£é™©
}
```

#### é£é™©è¯„ä¼°ç®—æ³•
```typescript
interface RiskAssessment {
  riskId: string;
  category: RiskCategory;
  level: RiskLevel;
  probability: number;        // å‘ç”Ÿæ¦‚ç‡ (0-1)
  impact: number;             // å½±å“ç¨‹åº¦ (1-10)
  riskScore: number;          // é£é™©è¯„åˆ†
  mitigation: string[];       // ç¼“è§£æªæ–½
  monitoring: string[];       // ç›‘æ§æŒ‡æ ‡
}

// é£é™©è¯„åˆ†è®¡ç®—
function calculateRiskScore(probability: number, impact: number): number {
  return probability * impact * 10; // 0-100åˆ†åˆ¶
}

// é£é™©ç­‰çº§åˆ¤å®š
function determineRiskLevel(score: number): RiskLevel {
  if (score >= 80) return RiskLevel.CRITICAL;
  if (score >= 60) return RiskLevel.HIGH;
  if (score >= 40) return RiskLevel.MEDIUM;
  return RiskLevel.LOW;
}
```

### 4. ç›‘æ§å’Œå‘Šè­¦ç³»ç»Ÿ

#### ç›‘æ§æŒ‡æ ‡
```typescript
interface MonitoringMetrics {
  timestamp: string;
  totalUsers: number;
  totalInvestment: string;
  productPurchases: Array<{
    user: string;
    productType: string;
    amount: string;
    tokenId: string;
    transactionHash: string;
    gasUsed: string;
    timestamp: string;
  }>;
  dailyStats: {
    date: string;
    newUsers: number;
    totalVolume: string;
    averageInvestment: string;
    gasEfficiency: string;
  };
  alerts: Array<{
    level: 'INFO' | 'WARNING' | 'ERROR';
    message: string;
    timestamp: string;
  }>;
}
```

#### å‘Šè­¦æœºåˆ¶
```typescript
// å‘Šè­¦çº§åˆ«å®šä¹‰
enum AlertLevel {
  INFO = 'INFO',           // ä¿¡æ¯çº§åˆ«
  WARNING = 'WARNING',     // è­¦å‘Šçº§åˆ«
  ERROR = 'ERROR',         // é”™è¯¯çº§åˆ«
  CRITICAL = 'CRITICAL'    // ä¸¥é‡çº§åˆ«
}

// å‘Šè­¦è§„åˆ™é…ç½®
interface AlertRule {
  id: string;
  name: string;
  metric: string;          // ç›‘æ§æŒ‡æ ‡
  condition: string;       // è§¦å‘æ¡ä»¶
  threshold: number;       // é˜ˆå€¼
  level: AlertLevel;       // å‘Šè­¦çº§åˆ«
  channels: string[];      // é€šçŸ¥æ¸ é“
  enabled: boolean;        // æ˜¯å¦å¯ç”¨
}

// å‘Šè­¦å¤„ç†
class AlertHandler {
  async processAlert(alert: Alert): Promise<void> {
    // 1. è®°å½•å‘Šè­¦æ—¥å¿—
    await this.logAlert(alert);
    
    // 2. å‘é€é€šçŸ¥
    await this.sendNotification(alert);
    
    // 3. æ‰§è¡Œè‡ªåŠ¨ä¿®å¤
    if (alert.level === AlertLevel.CRITICAL) {
      await this.autoRecovery(alert);
    }
    
    // 4. æ›´æ–°ç›‘æ§çŠ¶æ€
    await this.updateMonitoringStatus(alert);
  }
}
```

### 5. è¯„ä¼°æŠ¥å‘Šç³»ç»Ÿ

#### æŠ¥å‘Šç±»å‹
```typescript
enum ReportType {
  DAILY = 'DAILY',           // æ—¥æŠ¥
  WEEKLY = 'WEEKLY',         // å‘¨æŠ¥
  MONTHLY = 'MONTHLY',       // æœˆæŠ¥
  QUARTERLY = 'QUARTERLY',   // å­£æŠ¥
  ANNUAL = 'ANNUAL',         // å¹´æŠ¥
  CUSTOM = 'CUSTOM'          // è‡ªå®šä¹‰æŠ¥å‘Š
}

interface AssessmentReport {
  id: string;
  type: ReportType;
  period: {
    startDate: Date;
    endDate: Date;
  };
  summary: {
    overallScore: number;    // ç»¼åˆè¯„åˆ†
    riskLevel: RiskLevel;    // æ•´ä½“é£é™©ç­‰çº§
    keyMetrics: string[];    // å…³é”®æŒ‡æ ‡
    recommendations: string[]; // æ”¹è¿›å»ºè®®
  };
  details: {
    performanceMetrics: SystemPerformanceMetrics;
    blockchainMetrics: BlockchainPerformanceMetrics;
    riskAssessment: RiskAssessment[];
    securityAudit: SecurityAuditResult;
  };
  generatedAt: Date;
  generatedBy: string;
}
```

#### æŠ¥å‘Šç”Ÿæˆæµç¨‹
```
æ•°æ®æ”¶é›† â†’ æŒ‡æ ‡è®¡ç®— â†’ é£é™©è¯„ä¼° â†’ å®‰å…¨å®¡è®¡ â†’ æŠ¥å‘Šç”Ÿæˆ â†’ åˆ†å‘é€šçŸ¥
    â†“         â†“         â†“         â†“         â†“         â†“
   ç›‘æ§ç³»ç»Ÿ   ç®—æ³•å¼•æ“   é£é™©æ¨¡å‹   å®¡è®¡å·¥å…·   æ¨¡æ¿å¼•æ“   é€šçŸ¥ç³»ç»Ÿ
```

---

## ğŸ¯ **å®¡æ ¸ä¸è¯„ä¼°ç³»ç»Ÿä¼˜åŠ¿**

### 1. å®¡æ ¸ç³»ç»Ÿä¼˜åŠ¿
- **å®Œæ•´æ€§**: è¦†ç›–æ‰€æœ‰ç”¨æˆ·æ“ä½œå’Œç³»ç»Ÿäº‹ä»¶
- **å®æ—¶æ€§**: å®æ—¶è®°å½•å’Œç›‘æ§ï¼ŒåŠæ—¶å‘ç°å¼‚å¸¸
- **å¯è¿½æº¯**: å®Œæ•´çš„æ“ä½œé“¾è·¯è¿½è¸ªï¼Œæ”¯æŒå®¡è®¡å›æ”¾
- **å®‰å…¨æ€§**: å¤šé‡æƒé™æ§åˆ¶ï¼Œé˜²æ­¢è¶Šæƒæ“ä½œ
- **åˆè§„æ€§**: æ»¡è¶³é‡‘èè¡Œä¸šç›‘ç®¡è¦æ±‚

### 2. è¯„ä¼°ç³»ç»Ÿä¼˜åŠ¿
- **å…¨é¢æ€§**: è¦†ç›–ç³»ç»Ÿæ€§èƒ½ã€å®‰å…¨ã€é£é™©ç­‰å¤šä¸ªç»´åº¦
- **æ™ºèƒ½åŒ–**: è‡ªåŠ¨åŒ–çš„æŒ‡æ ‡è®¡ç®—å’Œé£é™©è¯„ä¼°
- **å¯è§†åŒ–**: ç›´è§‚çš„å›¾è¡¨å’ŒæŠ¥å‘Šå±•ç¤º
- **é¢„è­¦æ€§**: æå‰å‘ç°æ½œåœ¨é—®é¢˜å’Œé£é™©
- **å†³ç­–æ”¯æŒ**: ä¸ºç®¡ç†å†³ç­–æä¾›æ•°æ®æ”¯æ’‘

### 3. ç³»ç»Ÿé›†æˆä¼˜åŠ¿
- **ç»Ÿä¸€ç®¡ç†**: å®¡æ ¸å’Œè¯„ä¼°ç³»ç»Ÿç´§å¯†é›†æˆ
- **æ•°æ®å…±äº«**: é¿å…é‡å¤æ•°æ®æ”¶é›†å’Œå¤„ç†
- **ååŒå·¥ä½œ**: å®¡æ ¸ç»“æœç›´æ¥å½±å“è¯„ä¼°ç»“æœ
- **æŒç»­æ”¹è¿›**: åŸºäºè¯„ä¼°ç»“æœä¼˜åŒ–å®¡æ ¸æµç¨‹

---

## ğŸ“ˆ **ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡**

### å®¡æ ¸ç³»ç»Ÿæ€§èƒ½
- **æ—¥å¿—è®°å½•**: æ”¯æŒæ¯ç§’1000+æ“ä½œè®°å½•
- **æŸ¥è¯¢å“åº”**: å¤æ‚æŸ¥è¯¢å“åº”æ—¶é—´ < 500ms
- **å­˜å‚¨å®¹é‡**: æ”¯æŒTBçº§å®¡è®¡æ—¥å¿—å­˜å‚¨
- **æ£€ç´¢æ•ˆç‡**: æ”¯æŒå¤šç»´åº¦å¿«é€Ÿæ£€ç´¢

### è¯„ä¼°ç³»ç»Ÿæ€§èƒ½
- **æŒ‡æ ‡è®¡ç®—**: å®æ—¶è®¡ç®—ï¼Œå»¶è¿Ÿ < 100ms
- **æŠ¥å‘Šç”Ÿæˆ**: å¤æ‚æŠ¥å‘Šç”Ÿæˆæ—¶é—´ < 30ç§’
- **å‘Šè­¦å“åº”**: å¼‚å¸¸æ£€æµ‹åˆ°å‘Šè­¦å‘é€ < 10ç§’
- **æ•°æ®å¤„ç†**: æ”¯æŒç™¾ä¸‡çº§æ•°æ®ç‚¹åˆ†æ

---

## ğŸ”® **æœªæ¥å‘å±•æ–¹å‘**

### 1. æ™ºèƒ½åŒ–å‡çº§
- å¼•å…¥æœºå™¨å­¦ä¹ ç®—æ³•ï¼Œè‡ªåŠ¨è¯†åˆ«å¼‚å¸¸æ¨¡å¼
- å®ç°æ™ºèƒ½é£é™©è¯„ä¼°å’Œé¢„æµ‹
- è‡ªåŠ¨åŒ–çš„é—®é¢˜è¯Šæ–­å’Œä¿®å¤å»ºè®®

### 2. æ‰©å±•æ€§å¢å¼º
- æ”¯æŒæ›´å¤šç›‘æ§æŒ‡æ ‡å’Œè¯„ä¼°ç»´åº¦
- é›†æˆç¬¬ä¸‰æ–¹ç›‘æ§å’Œå®¡è®¡å·¥å…·
- æ”¯æŒå¤šç§Ÿæˆ·å’Œåˆ†å¸ƒå¼éƒ¨ç½²

### 3. åˆè§„æ€§æå‡
- æ»¡è¶³æ›´å¤šé‡‘èç›‘ç®¡è¦æ±‚
- æ”¯æŒå›½é™…å®¡è®¡æ ‡å‡†
- å¢å¼ºæ•°æ®éšç§ä¿æŠ¤

---

*æœ¬æ–‡æ¡£ä¸ºQAåº”ç”¨ç³»ç»Ÿçš„æ ¸å¿ƒæŠ€æœ¯æ–‡æ¡£ï¼ŒåŒ…å«å®¡æ ¸ç³»ç»Ÿå’Œè¯„ä¼°ç³»ç»Ÿçš„å®Œæ•´åˆ†æï¼Œå¦‚æœ‰ç–‘é—®è¯·è”ç³»å¼€å‘å›¢é˜Ÿã€‚*
